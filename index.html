<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg width='100' height='100' viewBox='0 0 100 100' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M30 20 L70 20 L70 50 L30 50 L30 80 L70 80' stroke='%23FF3333' stroke-width='8' stroke-linecap='round'/><path d='M10 60 L50 10 L90 60 M25 45 L75 45' stroke='%23FF3333' stroke-width='8' stroke-linecap='round'/><path d='M50 10 L50 90 M30 30 L50 50 L70 30' stroke='%23FF3333' stroke-width='8' stroke-linecap='round'/></svg>" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="manifest" href="/manifest.json" />
    <title>SAM IA - Premium Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0KOVEMcApdbeLaiDfGGfnB7VqZEJcgCmcETGcOKqrASBC9yvS1mYe" crossorigin="anonymous">
    <style>
      :root {
        --color-bg-main: #F8F9FA;
        --color-surface-primary: #FFFFFF;
        --color-surface-secondary: #F1F3F4;
        --color-border-subtle: #DADCE0;
        --color-text-main: #202124;
        --color-text-secondary: #5F6368;
        --color-sam-ia: #3c3c3c;
        --color-accent: #5856D6;
        --color-accent-blue: #1a73e8;
        --color-danger: #d93025;
      }
      .dark {
        --color-bg-main: #131314;
        --color-surface-primary: #1E1F20;
        --color-surface-secondary: #2C2C2E;
        --color-border-subtle: #3A3A3C;
        --color-text-main: #E8EAED;
        --color-text-secondary: #969BA1;
        --color-sam-ia: #E0E0E0;
        --color-accent: #5856D6;
        --color-accent-blue: #8ab4f8;
        --color-danger: #f28b82;
      }
    </style>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              'bg-main': 'var(--color-bg-main)',
              'surface-primary': 'var(--color-surface-primary)',
              'surface-secondary': 'var(--color-surface-secondary)',
              'border-subtle': 'var(--color-border-subtle)',
              'text-main': 'var(--color-text-main)',
              'text-secondary': 'var(--color-text-secondary)',
              'sam-ia': 'var(--color-sam-ia)',
              'accent': 'var(--color-accent)',
              'accent-blue': 'var(--color-accent-blue)',
              'danger': 'var(--color-danger)',
            },
            fontFamily: {
                sans: ['Inter', 'system-ui', 'sans-serif'],
            }
          },
        },
      }
    </script>
<script type="importmap">
{
  "imports": {
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.27.0",
    "uuid": "https://aistudiocdn.com/uuid@^13.0.0",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.554.0",
    "three/": "https://aistudiocdn.com/three@^0.181.2/",
    "three": "https://aistudiocdn.com/three@^0.181.2",
    "firebase/app": "https://esm.sh/firebase@10.13.0/app",
    "firebase/auth": "https://esm.sh/firebase@10.13.0/auth",
    "firebase/analytics": "https://esm.sh/firebase@10.13.0/analytics",
    "firebase/firestore": "https://esm.sh/firebase@10.13.0/firestore",
    "firebase/": "https://aistudiocdn.com/firebase@^12.6.0/"
  }
}
</script>
<style>
  html, body, #root {
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden; /* Prevents body scrolling */
    background-color: var(--color-bg-main);
    color: var(--color-text-main);
  }
  .streaming-message:not(:has(.prose))::after,
  .streaming-message .prose > :last-child::after {
    content: '';
    display: inline-block;
    width: 8px;
    height: 1.1em;
    background-color: var(--color-text-main);
    animation: blink 1s step-end infinite;
    vertical-align: text-bottom;
    margin-left: 2px;
  }
  @keyframes blink {
    from, to { opacity: 1; }
    50% { opacity: 0; }
  }

  /* --- PREMIUM LOADING SCREEN STYLES --- */
  #loading-screen {
      background-color: #030303;
      overflow: hidden;
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'Inter', sans-serif;
  }

  .ambient-glow {
      position: absolute;
      width: 120vw;
      height: 120vw;
      background: radial-gradient(circle, rgba(229, 9, 20, 0.06) 0%, rgba(0,0,0,0) 70%);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
      z-index: 1;
  }

  .grid-bg {
      position: absolute;
      inset: 0;
      background-image: 
          linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
          linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
      background-size: 40px 40px;
      transform: perspective(500px) rotateX(60deg) translateY(100px) scale(2);
      transform-origin: center top;
      mask-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 40%, rgba(0,0,0,0) 90%);
      -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 40%, rgba(0,0,0,0) 90%);
      opacity: 0.4;
      z-index: 0;
      pointer-events: none;
  }

  /* Glass Input Container */
  .pro-input-container {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5), inset 0 0 0 1px rgba(255, 255, 255, 0.05);
      border-radius: 24px;
      transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1);
      width: 100%;
      max-width: 420px;
  }
  
  .pro-input-container:focus-within {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(255, 255, 255, 0.2);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6), inset 0 0 0 1px rgba(255, 255, 255, 0.1), 0 0 30px rgba(229, 9, 20, 0.15);
      transform: translateY(-2px) scale(1.01);
  }

  .st-icon-stroke { stroke: #6b7280; transition: stroke 0.4s; }
  .pro-input-container:focus-within .st-icon-stroke { stroke: #E5E7EB; }
  
  .st-icon-fill { fill: #6b7280; transition: fill 0.4s; }
  .pro-input-container:focus-within .st-icon-fill { fill: #E5E7EB; }

  /* Logo Styles - Minimalist */
  .sam-logo-path {
      stroke: #FFFFFF; 
      stroke-width: 3;
      stroke-linecap: round;
      stroke-linejoin: round;
      fill: none;
      filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.3));
  }

</style>
</head>
<body class="bg-bg-main text-text-main">
    
    <!-- PREMIUM LOADING SCREEN -->
    <div id="loading-screen">
        
        <!-- Atmospherics -->
        <div class="ambient-glow"></div>
        <div class="grid-bg"></div>

        <div class="relative z-10 flex flex-col items-center w-full max-w-xl px-6">
            
            <!-- Logo -->
            <div class="mb-16 relative">
                <svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" class="overflow-visible">
                    <path class="sam-logo-path" d="M30 20 L70 20 L70 50 L30 50 L30 80 L70 80"/>
                    <path class="sam-logo-path" d="M10 60 L50 10 L90 60 M25 45 L75 45"/>
                    <path class="sam-logo-path" d="M50 10 L50 90 M30 30 L50 50 L70 30"/>
                </svg>
            </div>
            
            <!-- Input Flow -->
            <div id="input-group" class="hidden w-full opacity-0 flex flex-col items-center">
                <div class="pro-input-container flex items-center px-5 py-4 w-full">
                    <!-- Search Icon -->
                    <svg class="w-5 h-5 mr-4 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path class="st-icon-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    
                    <!-- Input -->
                    <input type="text" id="name-input" class="flex-1 bg-transparent border-none outline-none text-white placeholder-gray-500 text-lg font-normal tracking-wide" placeholder="IdentifÃ­cate" autocomplete="off">
                    
                    <!-- Right Icons -->
                    <div class="flex items-center gap-4 ml-3 pl-4 border-l border-white/10">
                        <svg class="w-5 h-5 cursor-pointer hover:opacity-80 transition-opacity text-gray-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                             <path class="st-icon-stroke" d="M5 12h14M12 5l7 7-7 7" />
                        </svg>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex justify-center gap-4 mt-8 opacity-0" id="search-buttons">
                     <button id="continue-button" class="px-8 py-3 bg-white text-black font-semibold text-sm rounded-full hover:bg-gray-200 transition-all shadow-[0_0_20px_rgba(255,255,255,0.1)]">
                        Acceder
                    </button>
                </div>
            </div>

        </div>
    </div>


    <script>
        // Theme init
        (function() {
            try {
                const settings = JSON.parse(localStorage.getItem('sam-settings'));
                if (settings && settings.theme === 'dark') {
                    document.documentElement.classList.add('dark');
                } else {
                     document.documentElement.classList.remove('dark');
                }
            } catch (e) { /* ignore */ }
        })();

        // Animation Logic
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof anime === 'undefined') return;
            
            // 1. Draw the Logo
            anime({
                targets:('.sam-logo-path'),
                strokeDashoffset: [anime.setDashoffset, 0],
                easing: 'easeInOutQuart',
                duration: 2500,
                delay: function(el, i) { return i * 150 },
                direction: 'normal',
                loop: false,
                complete: () => {
                    checkUserStatus();
                }
            });

            function checkUserStatus() {
                const guestName = localStorage.getItem('sam_ia_guest_name');
                
                // If guest name exists OR we are just showing the app, fade out.
                // The user can login via Firebase inside the app.
                if (guestName) {
                    fadeOutLoading();
                } else {
                    // New User - Reveal Input
                    const inputGroup = document.getElementById('input-group');
                    const buttons = document.getElementById('search-buttons');
                    inputGroup.style.display = 'flex';
                    
                    anime({
                        targets: inputGroup,
                        opacity: [0, 1],
                        translateY: [40, 0],
                        duration: 1200,
                        easing: 'easeOutExpo'
                    });
                    
                    anime({
                        targets: buttons,
                        opacity: [0, 1],
                        duration: 800,
                        delay: 400,
                        easing: 'linear'
                    });

                    setTimeout(() => {
                        const input = document.getElementById('name-input');
                        input.focus();
                    }, 500);
                }
            }

            function fadeOutLoading() {
                setTimeout(() => {
                    anime({
                        targets: '#loading-screen',
                        opacity: 0,
                        duration: 800,
                        easing: 'easeOutQuad',
                        complete: () => {
                            document.getElementById('loading-screen').style.display = 'none';
                            window.dispatchEvent(new CustomEvent('loadingScreenHidden'));
                        }
                    });
                }, 600);
            }

            // Button Handler
            const handleContinue = () => {
                const nameInput = document.getElementById('name-input');
                const name = nameInput.value.trim();
                if (name) {
                    localStorage.setItem('sam_ia_guest_name', name);
                    fadeOutLoading();
                } else {
                    // Shake
                    anime({
                        targets: '.pro-input-container',
                        translateX: [-5, 5, -5, 5, 0],
                        borderColor: ['rgba(255,255,255,0.1)', '#EF4444', 'rgba(255,255,255,0.1)'],
                        duration: 400,
                        easing: 'easeInOutSine'
                    });
                    nameInput.focus();
                }
            };

            document.getElementById('continue-button').addEventListener('click', handleContinue);
            document.getElementById('name-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleContinue();
            });
        });
    </script>
    <!-- FIN: BLOQUE DE PANTALLA DE CARGA SAM IA -->
    <style>
      .stranger-things-theme {
        --st-red: #E50914;
        --st-glow-border: 0 0 4px var(--st-red), 0 0 8px var(--st-red), 0 0 12px #ff0000;
        --st-glow-icon: drop-shadow(0 0 2px var(--st-red)) drop-shadow(0 0 4px var(--st-red));
      }

      .stranger-things-theme .st-border {
        border: 2px solid var(--st-red) !important;
        box-shadow: var(--st-glow-border);
        animation: neon-flicker-border 2s infinite alternate ease-in-out;
        transition: all 0.5s ease-in-out;
      }
      
      .stranger-things-theme .st-icon {
        color: var(--st-red) !important;
        stroke: var(--st-red) !important;
        filter: var(--st-glow-icon);
        animation: neon-flicker-icon 2s infinite alternate ease-in-out;
        transition: all 0.5s ease-in-out;
      }

      .stranger-things-theme .st-mic-button {
          background-color: transparent !important;
          border: 2px solid var(--st-red) !important;
          box-shadow: var(--st-glow-border);
          animation: neon-flicker-border 2s infinite alternate ease-in-out;
      }

      .stranger-things-theme .st-mic-button .st-icon {
          animation: none;
          filter: var(--st-glow-icon);
      }
      
      .stranger-things-theme #chat-textarea::placeholder {
          color: var(--st-red);
          text-shadow: 0 0 5px var(--st-red);
          opacity: 0.8;
      }

      @keyframes neon-flicker-border {
          0%, 18%, 22%, 25%, 53%, 57%, 100% {
            box-shadow: 0 0 4px var(--st-red), 0 0 8px var(--st-red), 0 0 12px #ff0000;
            border-color: #ff5555 !important;
          }
          20%, 24%, 55% {
            box-shadow: 0 0 4px var(--st-red);
            border-color: var(--st-red) !important;
          }
      }

      @keyframes neon-flicker-icon {
          0%, 18%, 22%, 25%, 53%, 57%, 100% {
            filter: drop-shadow(0 0 2px #ff5555) drop-shadow(0 0 4px #ff5555);
            color: #ff5555 !important;
            stroke: #ff5555 !important;
          }
          20%, 24%, 55% {
            filter: drop-shadow(0 0 2px var(--st-red));
            color: var(--st-red) !important;
            stroke: var(--st-red) !important;
          }
      }
    </style>
    <div id="root"></div>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIOOTenSvSAPnRdGO8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
    <script>
        function renderMath() {
            if (window.renderMathInElement && window.katex) {
                try {
                    renderMathInElement(document.getElementById('root'), {
                        delimiters: [
                            {left: '$$', right: '$$', display: true},
                            {left: '$', right: '$', display: false},
                            {left: '\\(', right: '\\)', display: false},
                            {left: '\\[', right: '\\]', display: true}
                        ],
                        throwOnError : false
                    });
                } catch (error) {
                    console.error("KaTeX rendering error:", error);
                }
            }
        }
    </script>
    <script type="module" src="./index.tsx"></script>
</body>
</html>