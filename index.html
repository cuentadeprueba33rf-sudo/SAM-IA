<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg width='100' height='100' viewBox='0 0 100 100' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M30 20 L70 20 L70 50 L30 50 L30 80 L70 80' stroke='%23FF3333' stroke-width='8' stroke-linecap='round'/><path d='M10 60 L50 10 L90 60 M25 45 L75 45' stroke='%23FF3333' stroke-width='8' stroke-linecap='round'/><path d='M50 10 L50 90 M30 30 L50 50 L70 30' stroke='%23FF3333' stroke-width='8' stroke-linecap='round'/></svg>" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="manifest" href="/manifest.json" />
    <title>SAM IA - Christmas Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0KOVEMcApdbeLaiDfGGfnB7VqZEJcgCmcETGcOKqrASBC9yvS1mYe" crossorigin="anonymous">
    <style>
      :root {
        --color-bg-main: #F8F9FA;
        --color-surface-primary: #FFFFFF;
        --color-surface-secondary: #F1F3F4;
        --color-border-subtle: #DADCE0;
        --color-text-main: #202124;
        --color-text-secondary: #5F6368;
        --color-sam-ia: #3c3c3c;
        --color-accent: #5856D6;
        --color-accent-blue: #1a73e8;
        --color-danger: #d93025;
      }
      .dark {
        --color-bg-main: #131314;
        --color-surface-primary: #1E1F20;
        --color-surface-secondary: #2C2C2E;
        --color-border-subtle: #3A3A3C;
        --color-text-main: #E8EAED;
        --color-text-secondary: #969BA1;
        --color-sam-ia: #E0E0E0;
        --color-accent: #5856D6;
        --color-accent-blue: #8ab4f8;
        --color-danger: #f28b82;
      }
      /* Christmas Theme Variables */
      :root {
        --xmas-red: #D42426;
        --xmas-green: #165B33;
        --xmas-gold: #FFD700;
      }
    </style>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              'bg-main': 'var(--color-bg-main)',
              'surface-primary': 'var(--color-surface-primary)',
              'surface-secondary': 'var(--color-surface-secondary)',
              'border-subtle': 'var(--color-border-subtle)',
              'text-main': 'var(--color-text-main)',
              'text-secondary': 'var(--color-text-secondary)',
              'sam-ia': 'var(--color-sam-ia)',
              'accent': 'var(--color-accent)',
              'accent-blue': 'var(--color-accent-blue)',
              'danger': 'var(--color-danger)',
            },
            fontFamily: {
                sans: ['Inter', 'system-ui', 'sans-serif'],
            }
          },
        },
      }
    </script>
<script type="importmap">
{
  "imports": {
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.27.0",
    "uuid": "https://aistudiocdn.com/uuid@^13.0.0"
  }
}
</script>
<style>
  html, body, #root {
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden; /* Prevents body scrolling */
    background-color: var(--color-bg-main);
    color: var(--color-text-main);
  }
  .streaming-message:not(:has(.prose))::after,
  .streaming-message .prose > :last-child::after {
    content: '';
    display: inline-block;
    width: 8px;
    height: 1.1em;
    background-color: var(--color-text-main);
    animation: blink 1s step-end infinite;
    vertical-align: text-bottom;
    margin-left: 2px;
  }
  @keyframes blink {
    from, to { opacity: 1; }
    50% { opacity: 0; }
  }

  /* --- CHRISTMAS LOADING SCREEN STYLES --- */
  #loading-screen {
      background: radial-gradient(circle at bottom, #0f2027, #203a43, #2c5364); /* Winter Night */
      background-color: #050505;
      overflow: hidden;
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
  }

  /* Falling Snow */
  .snow-container {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 2;
      pointer-events: none;
  }

  .snow {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.8);
      border-radius: 50%;
      box-shadow: 0 0 5px rgba(255, 255, 255, 0.6);
      animation: fallSnow linear infinite;
  }

  @keyframes fallSnow {
      0% { transform: translateY(-10vh) translateX(0); opacity: 0; }
      10% { opacity: 0.9; }
      90% { opacity: 0.7; }
      100% { transform: translateY(110vh) translateX(20px); opacity: 0; }
  }

  /* Search Bar Container */
  .google-search-bar {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      border-radius: 9999px;
      transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
  }
  
  .google-search-bar:focus-within {
      background: rgba(255, 255, 255, 0.15);
      border-color: var(--xmas-gold);
      box-shadow: 0 0 25px rgba(255, 215, 0, 0.3); /* Gold Glow */
      transform: translateY(-2px);
  }

  .st-icon-stroke { stroke: #E0E0E0; transition: stroke 0.3s; }
  .google-search-bar:focus-within .st-icon-stroke { stroke: #FFD700; }
  
  .st-icon-fill { fill: #E0E0E0; transition: fill 0.3s; }
  .google-search-bar:focus-within .st-icon-fill { fill: #FFD700; }

  /* Logo Styles - Christmas Theme */
  .sam-logo-path {
      stroke: #FF3333; /* Christmas Red */
      stroke-width: 6;
      stroke-linecap: round;
      stroke-linejoin: round;
      fill: none;
      filter: drop-shadow(0 0 5px #FF3333);
  }

</style>
</head>
<body class="bg-bg-main text-text-main">
    
    <!-- CHRISTMAS LOADING SCREEN -->
    <div id="loading-screen">
        
        <!-- Snow Atmosphere -->
        <div class="snow-container" id="snow-container"></div>

        <div class="relative z-10 flex flex-col items-center w-full max-w-xl px-6">
            
            <!-- Logo (Festive) -->
            <div class="mb-12 relative">
                <svg width="120" height="120" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" class="overflow-visible">
                    <path class="sam-logo-path" d="M30 20 L70 20 L70 50 L30 50 L30 80 L70 80"/>
                    <path class="sam-logo-path" d="M10 60 L50 10 L90 60 M25 45 L75 45"/>
                    <path class="sam-logo-path" d="M50 10 L50 90 M30 30 L50 50 L70 30"/>
                </svg>
            </div>
            
            <!-- Search Bar Input Flow -->
            <div id="input-group" class="hidden w-full opacity-0">
                <div class="google-search-bar flex items-center px-5 py-3.5 w-full">
                    <!-- Search Icon (Snowflake ish) -->
                    <svg class="w-5 h-5 mr-4 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path class="st-icon-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    
                    <!-- Input -->
                    <input type="text" id="name-input" class="flex-1 bg-transparent border-none outline-none text-white placeholder-gray-300 text-lg font-normal tracking-wide" placeholder="" autocomplete="off">
                    
                    <!-- Right Icons -->
                    <div class="flex items-center gap-4 ml-3 pl-4 border-l border-white/20">
                         <!-- Mic -->
                        <svg class="w-5 h-5 cursor-pointer hover:opacity-80 transition-opacity" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path class="st-icon-fill" d="M12 14C13.66 14 15 12.66 15 11V5C15 3.34 13.66 2 12 2C10.34 2 9 3.34 9 5V11C9 12.66 10.34 14 12 14Z" />
                            <path class="st-icon-fill" d="M19 11C19 14.87 15.87 18 12 18C8.13 18 5 14.87 5 11H3C3 15.53 6.39 19.26 10.71 19.88V22H13.29V19.88C17.61 19.26 21 15.53 21 11H19Z" />
                        </svg>
                        <!-- Camera -->
                        <svg class="w-5 h-5 cursor-pointer hover:opacity-80 transition-opacity" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path class="st-icon-stroke" d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                            <circle class="st-icon-stroke" cx="12" cy="13" r="4"></circle>
                        </svg>
                    </div>
                </div>
                
                <!-- Search Buttons -->
                <div class="flex justify-center gap-3 mt-8 opacity-0" id="search-buttons">
                     <button id="continue-button" class="px-5 py-2.5 bg-white/10 hover:bg-white/20 text-white text-sm rounded-full border border-white/10 backdrop-blur-sm transition-all hover:shadow-[0_0_15px_rgba(255,255,255,0.2)]">
                        Comenzar
                    </button>
                </div>
            </div>

        </div>
    </div>


    <script>
        // Theme init
        (function() {
            try {
                const settings = JSON.parse(localStorage.getItem('sam-settings'));
                if (settings && settings.theme === 'dark') {
                    document.documentElement.classList.add('dark');
                } else {
                     document.documentElement.classList.remove('dark');
                }
            } catch (e) { /* ignore */ }
        })();

        // Generate Snow Particles
        function createSnow() {
            const container = document.getElementById('snow-container');
            if (!container) return;
            const particleCount = 50;

            for (let i = 0; i < particleCount; i++) {
                const snow = document.createElement('div');
                snow.classList.add('snow');
                
                const size = Math.random() * 4 + 2;
                const left = Math.random() * 100;
                const duration = Math.random() * 5 + 5; // 5s to 10s fall
                const delay = Math.random() * 5;

                snow.style.width = `${size}px`;
                snow.style.height = `${size}px`;
                snow.style.left = `${left}%`;
                snow.style.animationDuration = `${duration}s`;
                snow.style.animationDelay = `-${delay}s`;
                
                container.appendChild(snow);
            }
        }

        // Animation Logic
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof anime === 'undefined') return;
            
            createSnow();

            // 1. Draw the Logo (Festive)
            anime({
                targets:('.sam-logo-path'),
                strokeDashoffset: [anime.setDashoffset, 0],
                easing: 'easeInOutQuart',
                duration: 2200,
                delay: function(el, i) { return i * 100 },
                direction: 'normal',
                loop: false,
                complete: () => {
                    checkUserStatus();
                }
            });

            function checkUserStatus() {
                const guestName = localStorage.getItem('sam_ia_guest_name');
                
                if (guestName) {
                    // Existent User - Fade out
                    setTimeout(() => {
                        anime({
                            targets: '#loading-screen',
                            opacity: 0,
                            duration: 800,
                            easing: 'easeOutQuad',
                            complete: () => {
                                document.getElementById('loading-screen').style.display = 'none';
                                window.dispatchEvent(new CustomEvent('loadingScreenHidden'));
                            }
                        });
                    }, 500);
                } else {
                    // New User - Reveal Search Bar
                    const inputGroup = document.getElementById('input-group');
                    const buttons = document.getElementById('search-buttons');
                    inputGroup.style.display = 'block';
                    
                    // Slide up animation
                    anime({
                        targets: inputGroup,
                        opacity: [0, 1],
                        translateY: [30, 0],
                        duration: 1000,
                        easing: 'easeOutExpo'
                    });
                    
                    // Buttons fade in slightly later
                    anime({
                        targets: buttons,
                        opacity: [0, 1],
                        duration: 800,
                        delay: 400,
                        easing: 'linear'
                    });

                    setTimeout(() => {
                        const input = document.getElementById('name-input');
                        input.focus();
                        input.placeholder = "Ingresa tu nombre..."; 
                    }, 300);
                }
            }

            // Button Handler
            const handleContinue = () => {
                const nameInput = document.getElementById('name-input');
                const name = nameInput.value.trim();
                if (name) {
                    localStorage.setItem('sam_ia_guest_name', name);
                    
                    // Exit Animation
                    anime({
                        targets: '#loading-screen',
                        opacity: 0,
                        scale: 1.05,
                        duration: 800,
                        easing: 'easeInOutQuad',
                        complete: () => {
                            document.getElementById('loading-screen').style.display = 'none';
                            window.dispatchEvent(new CustomEvent('loadingScreenHidden'));
                        }
                    });
                } else {
                    // Shake
                    anime({
                        targets: '.google-search-bar',
                        translateX: [-4, 4, -4, 4, 0],
                        borderColor: ['rgba(255,255,255,0.3)', '#FF3333', 'rgba(255,255,255,0.3)'],
                        duration: 300,
                        easing: 'easeInOutSine'
                    });
                    nameInput.focus();
                }
            };

            document.getElementById('continue-button').addEventListener('click', handleContinue);
            document.getElementById('name-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleContinue();
            });
        });
    </script>
    <!-- FIN: BLOQUE DE PANTALLA DE CARGA SAM IA -->
    <style>
      .stranger-things-theme {
        --st-red: #E50914;
        --st-glow-border: 0 0 4px var(--st-red), 0 0 8px var(--st-red), 0 0 12px #ff0000;
        --st-glow-icon: drop-shadow(0 0 2px var(--st-red)) drop-shadow(0 0 4px var(--st-red));
      }

      .stranger-things-theme .st-border {
        border: 2px solid var(--st-red) !important;
        box-shadow: var(--st-glow-border);
        animation: neon-flicker-border 2s infinite alternate ease-in-out;
        transition: all 0.5s ease-in-out;
      }
      
      .stranger-things-theme .st-icon {
        color: var(--st-red) !important;
        stroke: var(--st-red) !important;
        filter: var(--st-glow-icon);
        animation: neon-flicker-icon 2s infinite alternate ease-in-out;
        transition: all 0.5s ease-in-out;
      }

      .stranger-things-theme .st-mic-button {
          background-color: transparent !important;
          border: 2px solid var(--st-red) !important;
          box-shadow: var(--st-glow-border);
          animation: neon-flicker-border 2s infinite alternate ease-in-out;
      }

      .stranger-things-theme .st-mic-button .st-icon {
          animation: none;
          filter: var(--st-glow-icon);
      }
      
      .stranger-things-theme #chat-textarea::placeholder {
          color: var(--st-red);
          text-shadow: 0 0 5px var(--st-red);
          opacity: 0.8;
      }

      @keyframes neon-flicker-border {
          0%, 18%, 22%, 25%, 53%, 57%, 100% {
            box-shadow: 0 0 4px var(--st-red), 0 0 8px var(--st-red), 0 0 12px #ff0000;
            border-color: #ff5555 !important;
          }
          20%, 24%, 55% {
            box-shadow: 0 0 4px var(--st-red);
            border-color: var(--st-red) !important;
          }
      }

      @keyframes neon-flicker-icon {
          0%, 18%, 22%, 25%, 53%, 57%, 100% {
            filter: drop-shadow(0 0 2px #ff5555) drop-shadow(0 0 4px #ff5555);
            color: #ff5555 !important;
            stroke: #ff5555 !important;
          }
          20%, 24%, 55% {
            filter: drop-shadow(0 0 2px var(--st-red));
            color: var(--st-red) !important;
            stroke: var(--st-red) !important;
          }
      }
    </style>
    <div id="root"></div>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIOOTenSvSAPnRdGO8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
    <script>
        function renderMath() {
            if (window.renderMathInElement && window.katex) {
                try {
                    renderMathInElement(document.getElementById('root'), {
                        delimiters: [
                            {left: '$$', right: '$$', display: true},
                            {left: '$', right: '$', display: false},
                            {left: '\\(', right: '\\)', display: false},
                            {left: '\\[', right: '\\]', display: true}
                        ],
                        throwOnError : false
                    });
                } catch (error) {
                    console.error("KaTeX rendering error:", error);
                }
            }
        }
    </script>
    <script type="module" src="/index.tsx"></script>
    <script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js').then(registration => {
                console.log('ServiceWorker registration successful with scope: ', registration.scope);
            }, err => {
                console.log('ServiceWorker registration failed: ', err);
            });
        });
    }
    </script>
</body>
</html>
