<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg width='100' height='100' viewBox='0 0 100 100' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M30 20 L70 20 L70 50 L30 50 L30 80 L70 80' stroke='%23FF3333' stroke-width='8' stroke-linecap='round'/><path d='M10 60 L50 10 L90 60 M25 45 L75 45' stroke='%23FF3333' stroke-width='8' stroke-linecap='round'/><path d='M50 10 L50 90 M30 30 L50 50 L70 30' stroke='%23FF3333' stroke-width='8' stroke-linecap='round'/></svg>" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="manifest" href="/manifest.json" />
    <title>SAM IA - Premium Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0KOVEMcApdbeLaiDfGGfnB7VqZEJcgCmcETGcOKqrASBC9yvS1mYe" crossorigin="anonymous">
    <style>
      :root {
        --color-bg-main: #F8F9FA;
        --color-surface-primary: #FFFFFF;
        --color-surface-secondary: #F1F3F4;
        --color-border-subtle: #DADCE0;
        --color-text-main: #202124;
        --color-text-secondary: #5F6368;
        --color-sam-ia: #3c3c3c;
        --color-accent: #5856D6;
        --color-accent-blue: #1a73e8;
        --color-danger: #d93025;
      }
      .dark {
        --color-bg-main: #131314;
        --color-surface-primary: #1E1F20;
        --color-surface-secondary: #2C2C2E;
        --color-border-subtle: #3A3A3C;
        --color-text-main: #E8EAED;
        --color-text-secondary: #969BA1;
        --color-sam-ia: #E0E0E0;
        --color-accent: #5856D6;
        --color-accent-blue: #8ab4f8;
        --color-danger: #f28b82;
      }
    </style>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              'bg-main': 'var(--color-bg-main)',
              'surface-primary': 'var(--color-surface-primary)',
              'surface-secondary': 'var(--color-surface-secondary)',
              'border-subtle': 'var(--color-border-subtle)',
              'text-main': 'var(--color-text-main)',
              'text-secondary': 'var(--color-text-secondary)',
              'sam-ia': 'var(--color-sam-ia)',
              'accent': 'var(--color-accent)',
              'accent-blue': 'var(--color-accent-blue)',
              'danger': 'var(--color-danger)',
            },
            fontFamily: {
                sans: ['Inter', 'system-ui', 'sans-serif'],
            }
          },
        },
      }
    </script>
<script type="importmap">
{
  "imports": {
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.27.0",
    "uuid": "https://aistudiocdn.com/uuid@^13.0.0",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.554.0",
    "three/": "https://aistudiocdn.com/three@^0.181.2/",
    "three": "https://aistudiocdn.com/three@^0.181.2"
  }
}
</script>
<style>
  html, body, #root {
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden; /* Prevents body scrolling */
    background-color: var(--color-bg-main);
    color: var(--color-text-main);
  }
  .streaming-message:not(:has(.prose))::after,
  .streaming-message .prose > :last-child::after {
    content: '';
    display: inline-block;
    width: 8px;
    height: 1.1em;
    background-color: var(--color-text-main);
    animation: blink 1s step-end infinite;
    vertical-align: text-bottom;
    margin-left: 2px;
  }
  @keyframes blink {
    from, to { opacity: 1; }
    50% { opacity: 0; }
  }

  /* --- MEGA PRO LOADING SCREEN --- */
  #loading-screen {
      background-color: #050507;
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'Inter', sans-serif;
      overflow: hidden;
  }

  /* Background Effects */
  .cyber-aurora {
      position: absolute;
      width: 150vw;
      height: 150vw;
      background: radial-gradient(circle at 50% 50%, rgba(88, 86, 214, 0.08), rgba(229, 9, 20, 0.05), transparent 60%);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      animation: aurora-spin 20s linear infinite;
      z-index: 0;
      filter: blur(60px);
  }

  .noise-overlay {
      position: absolute;
      inset: 0;
      opacity: 0.03;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 1;
  }

  .scanline {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(to bottom, transparent 50%, rgba(0,0,0,0.2) 51%);
      background-size: 100% 4px;
      pointer-events: none;
      z-index: 2;
      opacity: 0.3;
  }

  /* Logo Container */
  .logo-stage {
      position: relative;
      z-index: 10;
      margin-bottom: 3rem;
  }

  .logo-glow {
      position: absolute;
      inset: -20px;
      background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
      filter: blur(20px);
      opacity: 0;
      transform: scale(0.8);
  }

  .sam-path {
      fill: none;
      stroke: #FFFFFF;
      stroke-width: 4;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-dasharray: 1000;
      stroke-dashoffset: 1000;
      filter: drop-shadow(0 0 8px rgba(255,255,255,0.5));
  }

  /* Boot Text */
  .boot-text {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.4);
      margin-top: 1rem;
      letter-spacing: 0.1em;
      height: 1.5rem;
      z-index: 10;
  }

  /* Holographic Input */
  .holo-input-wrapper {
      position: relative;
      z-index: 20;
      width: 100%;
      max-width: 380px;
      opacity: 0;
      transform: translateY(20px);
      display: none; /* Hidden initially */
  }

  .holo-input {
      width: 100%;
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 16px 24px;
      color: white;
      font-size: 1.1rem;
      outline: none;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      transition: all 0.4s cubic-bezier(0.22, 1, 0.36, 1);
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      text-align: center;
      letter-spacing: 0.05em;
  }

  .holo-input:focus {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(255, 255, 255, 0.3);
      box-shadow: 0 0 30px rgba(255, 255, 255, 0.1), 0 10px 40px rgba(0,0,0,0.6);
      transform: scale(1.02);
  }

  .holo-btn {
      margin-top: 20px;
      background: white;
      color: black;
      font-weight: 700;
      padding: 12px 32px;
      border-radius: 100px;
      border: none;
      cursor: pointer;
      opacity: 0;
      transform: translateY(10px);
      box-shadow: 0 0 20px rgba(255,255,255,0.2);
      transition: all 0.3s ease;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
  }

  .holo-btn:hover {
      transform: translateY(10px) scale(1.05);
      box-shadow: 0 0 30px rgba(255,255,255,0.4);
  }

  @keyframes aurora-spin {
      from { transform: translate(-50%, -50%) rotate(0deg); }
      to { transform: translate(-50%, -50%) rotate(360deg); }
  }

</style>
</head>
<body class="bg-bg-main text-text-main">
    
    <!-- MEGA PRO LOADING SCREEN -->
    <div id="loading-screen">
        <div class="cyber-aurora"></div>
        <div class="noise-overlay"></div>
        <div class="scanline"></div>

        <div class="logo-stage">
            <div class="logo-glow"></div>
            <svg width="120" height="120" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" class="overflow-visible">
                <!-- Split paths for cooler animation -->
                <path class="sam-path path-1" d="M30 20 L70 20 L70 50 L30 50 L30 80 L70 80"/>
                <path class="sam-path path-2" d="M10 60 L50 10 L90 60"/>
                <path class="sam-path path-3" d="M25 45 L75 45"/>
                <path class="sam-path path-4" d="M50 10 L50 90"/>
                <path class="sam-path path-5" d="M30 30 L50 50 L70 30"/>
            </svg>
        </div>

        <div id="boot-sequence" class="boot-text">INITIALIZING...</div>

        <div id="input-group" class="holo-input-wrapper flex flex-col items-center">
            <input type="text" id="name-input" class="holo-input" placeholder="IDENTIFÍCATE" autocomplete="off" spellcheck="false">
            <button id="continue-button" class="holo-btn">ACCEDER AL NÚCLEO</button>
        </div>
    </div>

    <script>
        // Theme init
        (function() {
            try {
                const settings = JSON.parse(localStorage.getItem('sam-settings'));
                if (settings && settings.theme === 'dark') {
                    document.documentElement.classList.add('dark');
                } else {
                     document.documentElement.classList.remove('dark');
                }
            } catch (e) { /* ignore */ }
        })();

        document.addEventListener('DOMContentLoaded', () => {
            if (typeof anime === 'undefined') return;

            const bootText = document.getElementById('boot-sequence');
            const messages = ["LOADING MODULES...", "CONNECTING NEURAL NET...", "OPTIMIZING CORE...", "SAM IA READY"];
            
            // Text Sequence Animation
            let msgIndex = 0;
            const textInterval = setInterval(() => {
                if(msgIndex < messages.length) {
                    bootText.style.opacity = 0;
                    setTimeout(() => {
                        bootText.innerText = messages[msgIndex];
                        bootText.style.opacity = 1;
                        msgIndex++;
                    }, 200);
                } else {
                    clearInterval(textInterval);
                }
            }, 800);

            // Logo Animation Sequence
            const timeline = anime.timeline({
                easing: 'easeOutExpo',
            });

            timeline
            .add({
                targets: '.sam-path',
                strokeDashoffset: [anime.setDashoffset, 0],
                duration: 2000,
                delay: anime.stagger(200),
                opacity: [0, 1]
            })
            .add({
                targets: '.logo-glow',
                opacity: [0, 0.6],
                scale: [0.8, 1.2],
                duration: 1500,
                easing: 'easeInOutSine',
                direction: 'alternate',
                loop: true
            }, '-=1000')
            .add({
                targets: '#boot-sequence',
                opacity: 0,
                duration: 500,
                complete: () => checkUserStatus()
            }, '+=500');

            function checkUserStatus() {
                const guestName = localStorage.getItem('sam-ia-guest_name');
                
                if (guestName) {
                    fadeOutLoading();
                } else {
                    // Show Input UI
                    const inputGroup = document.getElementById('input-group');
                    inputGroup.style.display = 'flex';
                    
                    anime({
                        targets: '#input-group',
                        opacity: [0, 1],
                        translateY: [20, 0],
                        duration: 1000,
                        easing: 'easeOutQuart'
                    });

                    anime({
                        targets: '#continue-button',
                        opacity: [0, 1],
                        translateY: [10, 0],
                        delay: 200,
                        duration: 800
                    });

                    setTimeout(() => {
                        document.getElementById('name-input').focus();
                    }, 500);
                }
            }

            function fadeOutLoading() {
                anime({
                    targets: '#loading-screen',
                    opacity: 0,
                    scale: 1.1,
                    duration: 800,
                    easing: 'easeInOutQuad',
                    complete: () => {
                        document.getElementById('loading-screen').style.display = 'none';
                        window.dispatchEvent(new CustomEvent('loadingScreenHidden'));
                    }
                });
            }

            // Interaction Handlers
            const handleContinue = () => {
                const nameInput = document.getElementById('name-input');
                const name = nameInput.value.trim();
                if (name) {
                    localStorage.setItem('sam-ia-guest_name', name);
                    // Success Animation
                    anime({
                        targets: '#input-group',
                        scale: 0.9,
                        opacity: 0,
                        duration: 300,
                        easing: 'easeInBack',
                        complete: fadeOutLoading
                    });
                } else {
                    // Error Shake
                    anime({
                        targets: '.holo-input',
                        translateX: [-10, 10, -10, 10, 0],
                        duration: 400,
                        easing: 'easeInOutSine',
                        borderColor: ['rgba(255,255,255,0.1)', '#EF4444', 'rgba(255,255,255,0.1)']
                    });
                    nameInput.focus();
                }
            };

            document.getElementById('continue-button').addEventListener('click', handleContinue);
            document.getElementById('name-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleContinue();
            });
        });
    </script>
    <!-- FIN: BLOQUE DE PANTALLA DE CARGA -->
    <style>
      .stranger-things-theme {
        --st-red: #E50914;
        --st-glow-border: 0 0 4px var(--st-red), 0 0 8px var(--st-red), 0 0 12px #ff0000;
        --st-glow-icon: drop-shadow(0 0 2px var(--st-red)) drop-shadow(0 0 4px var(--st-red));
      }

      .stranger-things-theme .st-border {
        border: 2px solid var(--st-red) !important;
        box-shadow: var(--st-glow-border);
        animation: neon-flicker-border 2s infinite alternate ease-in-out;
        transition: all 0.5s ease-in-out;
      }
      
      .stranger-things-theme .st-icon {
        color: var(--st-red) !important;
        stroke: var(--st-red) !important;
        filter: var(--st-glow-icon);
        animation: neon-flicker-icon 2s infinite alternate ease-in-out;
        transition: all 0.5s ease-in-out;
      }

      .stranger-things-theme .st-mic-button {
          background-color: transparent !important;
          border: 2px solid var(--st-red) !important;
          box-shadow: var(--st-glow-border);
          animation: neon-flicker-border 2s infinite alternate ease-in-out;
      }

      .stranger-things-theme .st-mic-button .st-icon {
          animation: none;
          filter: var(--st-glow-icon);
      }
      
      .stranger-things-theme #chat-textarea::placeholder {
          color: var(--st-red);
          text-shadow: 0 0 5px var(--st-red);
          opacity: 0.8;
      }

      @keyframes neon-flicker-border {
          0%, 18%, 22%, 25%, 53%, 57%, 100% {
            box-shadow: 0 0 4px var(--st-red), 0 0 8px var(--st-red), 0 0 12px #ff0000;
            border-color: #ff5555 !important;
          }
          20%, 24%, 55% {
            box-shadow: 0 0 4px var(--st-red);
            border-color: var(--st-red) !important;
          }
      }

      @keyframes neon-flicker-icon {
          0%, 18%, 22%, 25%, 53%, 57%, 100% {
            filter: drop-shadow(0 0 2px #ff5555) drop-shadow(0 0 4px #ff5555);
            color: #ff5555 !important;
            stroke: #ff5555 !important;
          }
          20%, 24%, 55% {
            filter: drop-shadow(0 0 2px var(--st-red));
            color: var(--st-red) !important;
            stroke: var(--st-red) !important;
          }
      }
    </style>
    <div id="root"></div>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIOOTenSvSAPnRdGO8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
    <script>
        function renderMath() {
            if (window.renderMathInElement && window.katex) {
                try {
                    renderMathInElement(document.getElementById('root'), {
                        delimiters: [
                            {left: '$$', right: '$$', display: true},
                            {left: '$', right: '$', display: false},
                            {left: '\\(', right: '\\)', display: false},
                            {left: '\\[', right: '\\]', display: true}
                        ],
                        throwOnError : false
                    });
                } catch (error) {
                    console.error("KaTeX rendering error:", error);
                }
            }
        }
    </script>
    <script type="module" src="./index.tsx"></script>
</body>
</html>